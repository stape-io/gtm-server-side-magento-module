<?php declare(strict_types=1);

use Stape\Gtm\Block\Gtm;

/**
 * @var Gtm $block
 * @var \Magento\Framework\Escaper $escaper
 */

?>
<?php $dataLayer = $block->getDataLayer(); ?>
<?php if (!empty($block->getContainerId())): ?>
    <?php if ($block->useCookieKeeper()): ?>
        <?= $block->getChildHtml('stape.gtm.advanced'); ?>
    <?php else: ?>
        <?= $block->getChildHtml('stape.gtm.default'); ?>
    <?php endif; ?>
<?php endif; ?>

<?php $dataLayer = $block->getDataLayer(); ?>

<?php if ($dataLayer && $block->isDataLayerEnabled()): ?>
    <?php $extraData = $block->getExtraData(); ?>
    <script type="module">
        import { Datalayer } from '<?= $escaper->escapeUrl($block->getViewFileUrl("Stape_Gtm::js/hyva/Datalayer.js")) ?>';
        window.stapeDataLayer = new Datalayer({
            productItemSelector: '<?= $escaper->escapeHtml($block->getProductItemSelector()) ?>',
            eventSuffix: '<?= $escaper->escapeHtml($block->getEventSuffix()) ?>',
            <?php // phpcs:disable ?>
            pageType: '<?= /* @noEscape */ $block->getPageType(); ?>',
            defaultEventData: <?= /* @noEscape */ $dataLayer->getJson(); ?> || {},
            extraData: <?= /* @noEscape */ $extraData ? $extraData->getJson() : '{}'; ?>
            <?php // phpcs:enable ?>
        });
    </script>
    <?= $this->getChildHtml('stape.gtm.extradata'); ?>
<?php endif; ?>


